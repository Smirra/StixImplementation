using System.ComponentModel.DataAnnotations;

namespace Vulnerabilities.Api.Models;
public class Vulnerability
{
    public Vulnerability()
    {
        Id ??= $"vulnerability--{Guid.NewGuid()}";
        Created = Created == default ? DateTime.UtcNow : Created;
        Modified = Modified == default ? DateTime.UtcNow : Modified;
    }

    private const string uuidPattern = @"[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}";

    // Required Common Properties
    [Required]
    [RegularExpression("^vulnerability$", ErrorMessage = "Type must be 'vulnerability'")]
    public string Type { get; set; } = null!;

    [Required]
    [RegularExpression(@"^2\.1$", ErrorMessage = "SpecVersion must be '2.1'")]
    public string SpecVersion { get; set; } = null!;

    [Required]
    [RegularExpression($"^vulnerability--{uuidPattern}$", ErrorMessage = "Id must be on the form 'vulnerability--<UUID>'")]
    public string Id { get; set; }  = null!;
    [Required]
    public DateTime Created { get; set; }
    [Required]
    public DateTime Modified { get; set; }

    /*

        Optional Common Properties ignore for this POC

    */

    // Vulnerability Specific Properties
    [Required]
    [RegularExpression(@"^CVE-\d{4}-\d{4,7}$")]
    public string Name { get; set; } = null!;

    public string? Description { get; set; }
}